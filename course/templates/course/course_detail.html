{% load widget_tweaks %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title>uicCourse | {{course_data.course_name_en}}</title>
    <!-- Bootstrap core CSS -->
    <link href="https://cdn.bootcss.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <style type="text/css">
        /* Sticky footer styles
        -------------------------------------------------- */
        html {
            position: relative;
            min-height: 100%;
        }

        body {
            /* Margin bottom by footer height */
            margin-bottom: 60px;
        }

        .list-group{
            width: 100%;
        }


    </style>
    {% load static %}
</head>

<body>
{% include "course/header.html" %}
{% include "course/messager.html" %}
<main role="main" class="container mb-5">
<div class="row">
    <div class="col-md-8 border-right">
        <h1>{{course_data.course_id | upper}}: {{ course_data.course_name_en }}</h1>
        <p class="lead">{{ course_data.course_name_cn }}</p>
        <p class="text-muted">Updated {{course_data.update_time}}</p>
        <div class="row">
            <div class="col-md-6">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">Course Code:
                        <label class="badge badge-primary">{{course_data.course_id | upper}}</label>
                    </li>
                    <li class="list-group-item">Course Category:
                        <label class="badge badge-info">
                            {% if course_data.course_type.name|length > 30 %}
                                {{course_data.course_type.name_abbr}}
                            {% else %}
                                {{course_data.course_type.name}}
                            {% endif %}
                        </label>
                    </li>
                    <li class="list-group-item">Course Units:
                        <label class="badge badge-warning">{{course_data.course_units}}</label>
                    </li>
                </ul>
            </div>
            <div class="col-md-6">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">Division:
                    {% for division in division_involve %}
                        <label class="badge badge-success">{{ division }}</label>
                    {% endfor %}
                    </li>
                    <li class="list-group-item">Major:
                        {% if majors %}
                            {% for major in majors %}
                            <label class="badge badge-danger">{{ major.major.major_en_abbr }}</label>
                            {% endfor %}
                        {% else %}
                            None
                        {% endif %}
                    </li>
                    <li class="list-group-item">Pre-Request:

                        {% if course_data.course_pre_request %}
                        <a href="{% url 'course_detail' course_data.course_pre_request.id %}">
                            <label class="badge badge-dark">{{course_data.course_pre_request}}</label>
                        </a>
                        {% else %}
                            <label class="badge badge-dark">None</label>
                        {% endif %}

                    </li>
                </ul>
            </div>
            <ul class="list-group list-group-flush">
                <h5 class="px-3">Course Descriptions: </h5>
                <li class="list-group-item">{{course_data.course_description}}</li>
            </ul>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card" style="margin-bottom: 1rem!important;">
            <div class="card-header">
                <h4 class="card-text text-center">Overall Score</h4>
            </div>
            <div class="card-body">
                <p class="card-text text-center text-dark" style="font-size: 5rem"><span
                        id="current_score">{{course_vote_status.score|floatformat:1}}</span>/<span
                        class="h2 text-secondary">10</span></p>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h4 class="card-text text-center">Quick Vote</h4>
            </div>
            <div class="card-body mx-auto">
                <div class="btn-group btn-group-lg" role="group" aria-label="Basic example">
                    {% if user_vote.vote_status == 0 %}
                        <button class="btn btn-outline-success" id="upvote_btn">
                            <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                            {{course_vote_status.upvote}}
                        </button>
                        <button class="btn btn-outline-danger" id="downvote_btn">
                            <i class="fa fa-thumbs-down" aria-hidden="true"></i>
                        </button>
                    {% else %}
                        {% if user_vote.vote_status == 1 %}
                            <button class="btn btn-outline-success" id="upvote_btn">
                                <i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                {{course_vote_status.upvote}}
                            </button>
                            <button class="btn btn-outline-danger" id="downvote_btn">
                                <i class="fa fa-thumbs-o-down" aria-hidden="true"></i>
                            </button>
                        {% else %}
                            <button class="btn btn-outline-success" id="upvote_btn">
                                <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                                {{course_vote_status.upvote}}
                            </button>
                            <button class="btn btn-outline-danger" id="downvote_btn">
                                <i class="fa fa-thumbs-o-down" aria-hidden="true"></i>
                            </button>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<div>
{% if user.is_staff or user.is_superuser %}
<nav class="py-2 border-top border-bottom">
    <a href="{% url 'course_modify' course_data.id %}" class="btn btn-primary btn-sm my-1">Modify</a>
    <button onclick="AlertIt()" class="btn btn-danger btn-sm my-1">Delete</button>
</nav>
{% endif %}
</div>
</main>
{% include "course/footer.html" %}
<script src="https://cdn.bootcss.com/limonte-sweetalert2/7.11.0/sweetalert2.all.min.js"></script>
<script>
    function AlertIt() {
        var answer = confirm("Are you sure you want to delete this course record?");
        if (answer) {
            window.location = "{% url 'course_delete' course_data.id %}"
        }
    }
    var voted = 0;
    $("#upvote_btn").click(function () {
        if (!voted) {
            $.ajax({
                url: '{% url "vote_course" course_data.id %}',
                data: {
                    'vote_action': 'upvote'
                },
                dataType: 'json',
                success: function (data) {
                    if (data.is_success) {
                        console.log(data.new_upvote)
                        $("#upvote_btn").html("<i class=\"fa fa-thumbs-up\" aria-hidden=\"true\"></i>\n" + (parseInt(data.new_upvote)));
                        $("#downvote_btn").html("<i class=\"fa fa-thumbs-o-down\" aria-hidden=\"true\"></i>\n");
                        voted = 1;
                        $("#current_score").html(data.current_score.toFixed(1));
                        swal(
                            'Voted!',
                            'You have successfully given this class an up vote.',
                            'success'
                        )
                    }
                }
            });
        }
        else {
            voted_alert();
        }
    });
    $("#downvote_btn").click(function () {
        if (!voted) {
            $.ajax({
                url: '{% url "vote_course" course_data.id %}',
                data: {
                    'vote_action': 'downvote'
                },
                dataType: 'json',
                success: function (data) {
                    if (data.is_success) {
                        console.log(data.new_upvote)
                        $("#upvote_btn").html("<i class=\"fa fa-thumbs-o-up\" aria-hidden=\"true\"></i>\n" + (parseInt(data.new_upvote)));
                        $("#downvote_btn").html("<i class=\"fa fa-thumbs-down\" aria-hidden=\"true\"></i>\n");
                        voted = 1;
                        $("#current_score").html(data.current_score.toFixed(1));
                        swal(
                            'Voted!',
                            'You have successfully given this class a down vote.',
                            'success'
                        )
                    }
                }
            });
        }
        else {
            voted_alert();
        }
    });

    function voted_alert() {
        swal(
            'Voted!',
            'You have been already voted.',
            'warning'
        )
    }
</script>
</body>
</html>
